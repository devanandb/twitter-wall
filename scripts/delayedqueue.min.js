(function(){var c,a;var b=function(e,d){return function(){return e.apply(d,arguments)}};a=(typeof exports!=="undefined"&&exports!==null)?exports:this;c=function(){this.itemCallback=null;this.itemDelay=0;this.emptyCallback=null;this.emptyDelay=0;this.queue=[];this.processed={};this.timer=null;return this};c.prototype.onitem=function(d,e){this.itemCallback=e;this.itemDelay=d;return this};c.prototype.onempty=function(d,e){this.emptyCallback=e;this.emptyDelay=d;return this};c.prototype.process=function(){if(this.queue.length!==0){this.itemCallback(this.queue.shift())}else{this.stop();window.setTimeout((b(function(){return this.emptyCallback()},this)),this.emptyDelay)}return this};c.prototype.push=function(f){var h,g,e,d,i;if(!(typeof(h=this.timer)!=="undefined"&&h!==null)&&this.queue.length===0){this.start()}if(!f instanceof Array){f=[f]}e=f;for(g=0,d=e.length;g<d;g++){i=e[g];if(!this.processed[i.id]){this.queue.push(i)}this.processed[i.id]=true}this.queue.sort((function(k,j){return k.id-j.id}));return this};c.prototype.start=function(){var d;if(!(typeof(d=this.timer)!=="undefined"&&d!==null)){this.timer=window.setInterval((b(function(){return this.process()},this)),this.itemDelay)}return this};c.prototype.stop=function(){window.clearInterval(this.timer);this.timer=null;return this};a.DelayedQueue=c})();