// twitterlib.js (c) 2009 Remy Sharp
// Licensed under the terms of the MIT license.
(function(m,k){var p=+new Date,h=this,n=h.document,d=n.getElementsByTagName("head")[0],i={},u={},s={"&quot;":'"',"&lt;":"<","&gt;":">"},b={search:"http://search.twitter.com/search.json?q=%search%&page=%page|1%&rpp=%limit|100%&since_id=%since|remove%",timeline:"http://twitter.com/statuses/user_timeline/%user%.json?count=%limit|200%&page=%page|1%&since_id=%since|remove%",list:"http://api.twitter.com/1/%user%/lists/%list%/statuses.json?page=%page|1%&per_page=%limit|200%&since_id=%since|remove%",favs:"http://twitter.com/favorites/%user%.json?page=%page|1%"},t=b,e,v=false;var c=function(){return{entities:function(y){return y.replace(/(&[a-z0-9]+;)/g,function(z){return s[z]})},link:function(y){return y.replace(/[a-z]+:\/\/[a-z0-9-_]+\.[a-z0-9-_:~\+#%&\?\/.=]+[^:\.,\)\s*$]/ig,function(z){return'<a href="'+z+'" rel="nofollow">'+((z.length>25)?z.substr(0,24)+"...":z)+"</a>"})},at:function(y){return y.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15}(\/[a-zA-Z0-9-_]+)*)/g,function(z,B,A){return B+'@<a href="http://twitter.com/'+A+'" rel="nofollow">'+A+"</a>"})},hash:function(y){return y.replace(/(^|[^&\w'"]+)\#([a-zA-Z0-9_]+)/g,function(z,B,A){return B+'<a href="http://search.twitter.com/search?q=%23'+A+'" rel="nofollow">#'+A+"</a>"})},clean:function(y){return this.hash(this.at(this.link(y)))}}}();var f=function(){var y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{time:function(B){var z=B.getHours(),C=B.getMinutes()+"",A="AM";if(z==0){z=12}else{if(z==12){A="PM"}else{if(z>12){z-=12;A="PM"}}}if(C.length==1){C="0"+C}return z+":"+C+" "+A},date:function(A){var F=A.toDateString().split(/ /),C=y[A.getMonth()],z=A.getDate()+"",G=~~(z),B=A.getFullYear(),E=(new Date()).getFullYear(),D="th";if((G%10)==1&&z.substr(0,1)!="1"){D="st"}else{if((G%10)==2&&z.substr(0,1)!="1"){D="nd"}else{if((G%10)==3&&z.substr(0,1)!="1"){D="rd"}}}if(z.substr(0,1)=="0"){z=z.substr(1)}return C+" "+z+D+(E!=B?", "+B:"")},datetime:function(B){var z=B.split(" "),A=new Date(Date.parse(z[1]+" "+z[2]+", "+z[5]+" "+z[3]+" GMT"));return this.time(A)+" "+this.date(A)},iso8601:function(B){var z=B.split(" "),A=new Date(Date.parse(z[1]+" "+z[2]+", "+z[5]+" "+z[3]+" GMT"));function C(D){return D<10?"0"+D:D}return A.getUTCFullYear()+"-"+C(A.getUTCMonth()+1)+"-"+C(A.getUTCDate())+"T"+C(A.getUTCHours())+":"+C(A.getUTCMinutes())+":"+C(A.getUTCSeconds())+"Z"},relative:function(B){var z=B.split(" "),A=new Date(Date.parse(z[1]+" "+z[2]+", "+z[5]+" "+z[3]+" GMT")),D=(arguments.length>1)?arguments[1]:new Date(),E=~~((D.getTime()-A.getTime())/1000),C="";if(E<5){C="less than 5 seconds ago"}else{if(E<30){C="half a minute ago"}else{if(E<60){C="less than a minute ago"}else{if(E<120){C="1 minute ago"}else{if(E<(45*60)){C=(~~(E/60)).toString()+" minutes ago"}else{if(E<(2*60*60)){C="about 1 hour ago"}else{if(E<(24*60*60)){C="about "+(~~(E/3600)).toString()+" hours ago"}else{C=this.time(A)+" "+this.date(A)}}}}}}}return C}}}();var j=(function(){return{match:function(D,A,y){var z=0,B="",C=D.text.toLowerCase();if(typeof A=="string"){A=this.format(A)}if(A.not.length){for(z=0;z<A.not.length;z++){if(C.indexOf(A.not[z])!==-1){return false}}if(!A.and.length&&!A.or.length){return true}}if(A.and.length){for(z=0;z<A.and.length;z++){B=A.and[z];if(B.substr(0,3)==="to:"){if(!RegExp("^@"+B.substr(3)).test(C)){return false}}else{if(B.substr(0,5)=="from:"){if(D.user.screen_name!==B.substr(5)){return false}}else{if(C.indexOf(B)===-1){return false}}}}}if(A.or.length){for(z=0;z<A.or.length;z++){B=A.or[z];if(B.substr(0,3)==="to:"){if(RegExp("^@"+B.substr(3)).test(C)){return true}}else{if(B.substr(0,5)=="from:"){if(D.user.screen_name===B.substr(5)){return true}}else{if(C.indexOf(A.or[z])!==-1){return true}}}}}else{if(A.and.length){return true}}return false},format:function(G,E){var y=[],C=[],F=[],B=0,A=[],D="",z="";G.replace(/(-?["'](.*?)["']|\S+\b)/g,function(H){var I=false;if(H.substr(0,1)=="-"){I=true}H=H.replace(/["']+|["']+$/g,"");if(I){A.push(H.substr(1).toLowerCase())}else{y.push(H)}});for(B=0;B<y.length;B++){if(y[B]=="OR"&&y[B+1]){C.push(y[B-1].toLowerCase());C.push(y[B+1].toLowerCase());B++;F.pop()}else{F.push(y[B].toLowerCase())}}return{or:C,and:F,not:A}},matchTweets:function(D,C,y){var z=[],B,A=0;if(typeof C=="string"){C=this.format(C)}for(A=0;A<D.length;A++){if(this.match(D[A],C,y)){z.push(D[A])}}return z}}})();function x(z){var y='<li><div class="tweet">';y+='<div class="vcard"><a href="http://twitter.com/'+z.user.screen_name+'" class="url"><img style="height: 48px; width: 48px;" alt="'+z.user.name+'" class="photo fn" height="48" src="'+z.user.profile_image_url+'" width="48" /></a></div>';y+='<div class="hentry"><strong><a href="http://twitter.com/';y+=z.user.screen_name+'" ';y+='title="'+z.user.name+'">'+z.user.screen_name+"</a></strong> ";y+='<span class="entry-content">';y+=k[m].ify.clean(z.text);y+='</span> <span class="meta entry-meta"><a href="http://twitter.com/'+z.user.screen_name;y+="/status/"+z.id+'" class="entry-date" rel="bookmark"><span class="published" title="';y+=z.created_at+'">'+k[m].time.datetime(z.created_at)+"</span></a>";if(z.source){y+=" <span>from "+z.source+"</span>"}y+="</span></div></div></li>";return y}function r(y){var z=n.getElementById(m+y);if(z){d.removeChild(n.getElementById(m+y))}delete u[m+y];h[m+y]=e;try{delete h[m+y]}catch(A){}}function g(B,A,C){var y=n.createElement("script"),z=null;if(A==e){A={}}p++;u[m+p]=true;h[m+p]=(function(E,D){return function(H){var F=0,G=[];if(H.results){H=H.results;F=H.length;while(F--){H[F].user={id:H[F].from_user_id,screen_name:H[F].from_user,profile_image_url:H[F].profile_image_url};H[F].source=k[m].ify.entities(H[F].source);G=H[F].created_at.split(" ");H[F].created_at=[G[0],G[2],G[1],G[4],G[5],G[3]].join(" ").replace(/,/,"")}}else{if(H.length&&H[0].sender){F=H.length;while(F--){H[F].user=H[F].sender;H[F].originalText=H[F].text;H[F].text="@"+H[F].recipient_screen_name+" "+H[F].text}}}D.originalTweets=H;if(D.filter){H=j.matchTweets(H,D.filter)}if(v&&D.page>1){sessionStorage.setItem(m+".page"+D.page,"true");sessionStorage.setItem(m+".page"+D.page+".tweets",JSON.stringify(H));sessionStorage.setItem(m+".page"+D.page+".originalTweets",JSON.stringify(D.originalTweets))}D.cached=false;C.call(k[m],H,D);r(E)}})(p,A);z=B.match(/callback=(.*)/);if(z!=null&&z.length>1){h[z[1]]=h[m+p]}else{B+="&callback="+m+p}if(!v||A.page<=1||(v&&sessionStorage.getItem(m+".page"+A.page)==null)){y.src=B;y.id=m+p;d.appendChild(y)}else{if(v){r(p);A.cached=true;A.originalTweets=JSON.parse(sessionStorage.getItem(m+".page"+A.page+".originalTweets"));C.call(k[m],JSON.parse(sessionStorage.getItem(m+".page"+A.page+".tweets")),A)}}}function q(z,y){return t[z].replace(/(\b.*?)%(.*?)(\|.*?)?%/g,function(A,D,B,C){if(C&&C.substr(1)=="remove"&&y[B]==e){return""}return D+(y[B]===e?C.substr(1):y[B])})}function l(y,z){if(typeof y=="function"){z=y;y={}}if(y===e){y={}}y.page=y.page||1;y.callback=z;if(y.limit===0){delete y.limit}return y}function o(B,y,z){i={method:B,arg:y,options:z,callback:z.callback,page:z.page||1};if(v){var A=JSON.parse(sessionStorage.getItem(m+".last_request")||"{}");if(i.method!=A.method||i.arg!=A.arg){w();sessionStorage.setItem(m+".last_request",JSON.stringify(i))}}}function w(){var y=sessionStorage.length;while(y--){if(sessionStorage.key(y).substr(0,m.length)==m){sessionStorage.removeItem(sessionStorage.key(y))}}}function a(z,y,A){if(y&&t[z]==e){t[z]=y}if(this[z]==e){this[z]=function(C,B,D){if(typeof C=="function"){D=C;C=""}else{if(C.toString()=="[Object object]"){D=B;B=C;C=""}}B=l(B,D);o(z,C,B);B[z]=B.user=C;B.search=encodeURIComponent(C);if(B.callback){g(q(z,B),B,B.callback)}return this}}return this[z]}k[m]={custom:a,status:function(y,z,A){z=l(z,A);z.limit=1;o("status",y,z);return this.timeline(y,z,z.callback)},list:function(z,y,B){var A=z.split("/");y=l(y,B);o("list",z,y);y.user=A[0];y.list=A[1];if(y.callback){g(q("list",y),y,y.callback)}return this},next:function(){if(i.method){i.page++;i.options.page=i.page;this[i.method](i.arg,i.options,i.callback)}return this},time:f,ify:c,filter:j,cancel:function(){for(var y in u){h[y]=(function(){return function(z){r(z)}})(y.replace(m,""))}u={};return this},reset:function(){t=b;i.method=""},render:x,debug:function(z){for(var y in z){t[y]=z[y]}return this},cache:function(y){v=y==e?true:y;if(!h.JSON||!h.sessionStorage){v=false}}};k[m].custom("search");k[m].custom("timeline");k[m].custom("favs")})("twitterlib",this);
